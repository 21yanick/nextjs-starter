{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/templates/nextjs-saas-template/lib/supabase/middleware.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\nimport { NextRequest, NextResponse } from 'next/server';\nimport { Database } from '@/types/database';\n\nexport async function updateSession(request: NextRequest) {\n  let supabaseResponse = NextResponse.next({\n    request,\n  });\n\n  const supabase = createServerClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll();\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value }) =>\n            request.cookies.set(name, value)\n          );\n          supabaseResponse = NextResponse.next({\n            request,\n          });\n          cookiesToSet.forEach(({ name, value, options }) =>\n            supabaseResponse.cookies.set(name, value, options)\n          );\n        },\n      },\n    }\n  );\n\n  // IMPORTANT: Avoid writing any logic between createServerClient and\n  // supabase.auth.getUser(). A simple mistake could make it very hard to debug\n  // issues with users being randomly logged out.\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n\n  // IMPORTANT: You *must* return the supabaseResponse object as it is. If you're\n  // creating a new response object with NextResponse.next() make sure to:\n  // 1. Pass the request in it, like so:\n  //    const myNewResponse = NextResponse.next({ request })\n  // 2. Copy over the cookies, like so:\n  //    myNewResponse.cookies.setAll(supabaseResponse.cookies.getAll())\n  // 3. Change the myNewResponse object instead of the supabaseResponse object\n\n  return { supabaseResponse, user };\n}"],"names":[],"mappings":";;;AAAA;AAAA;AACA;AAAA;;;AAGO,eAAe,cAAc,OAAoB;IACtD,IAAI,mBAAmB,sYAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QACvC;IACF;IAEA,MAAM,WAAW,CAAA,GAAA,8RAAA,CAAA,qBAAkB,AAAD,EAChC,QAAQ,GAAG,CAAC,wBAAwB,EACpC,QAAQ,GAAG,CAAC,6BAA6B,EACzC;QACE,SAAS;YACP;gBACE,OAAO,QAAQ,OAAO,CAAC,MAAM;YAC/B;YACA,QAAO,YAAY;gBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,GACnC,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;gBAE5B,mBAAmB,sYAAA,CAAA,eAAY,CAAC,IAAI,CAAC;oBACnC;gBACF;gBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,iBAAiB,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YAE9C;QACF;IACF;IAGF,oEAAoE;IACpE,6EAA6E;IAC7E,+CAA+C;IAE/C,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,+EAA+E;IAC/E,wEAAwE;IACxE,sCAAsC;IACtC,0DAA0D;IAC1D,qCAAqC;IACrC,qEAAqE;IACrE,4EAA4E;IAE5E,OAAO;QAAE;QAAkB;IAAK;AAClC"}},
    {"offset": {"line": 72, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/templates/nextjs-saas-template/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\nimport { updateSession } from '@/lib/supabase/middleware';\n\nexport async function middleware(request: NextRequest) {\n  // IMPORTANT: Handle auth first, then apply security headers\n  const { supabaseResponse, user } = await updateSession(request);\n  \n  // Protected routes - require authentication\n  const protectedRoutes = ['/dashboard', '/settings', '/profile'];\n  const isProtectedRoute = protectedRoutes.some(route => \n    request.nextUrl.pathname.startsWith(route)\n  );\n  \n  // Auth routes - redirect if already logged in\n  const authRoutes = ['/auth/login', '/auth/register', '/auth/reset'];\n  const isAuthRoute = authRoutes.some(route => \n    request.nextUrl.pathname.startsWith(route)\n  );\n  \n  // Route protection logic\n  if (isProtectedRoute && !user) {\n    // User is not authenticated, redirect to login\n    const loginUrl = new URL('/auth/login', request.url);\n    loginUrl.searchParams.set('redirectTo', request.nextUrl.pathname);\n    return NextResponse.redirect(loginUrl);\n  }\n  \n  if (isAuthRoute && user) {\n    // User is already authenticated, redirect to dashboard\n    return NextResponse.redirect(new URL('/dashboard', request.url));\n  }\n  \n  // Apply security headers to the response\n  const response = supabaseResponse;\n  \n  // Security headers\n  response.headers.set('X-Frame-Options', 'DENY');\n  response.headers.set('X-Content-Type-Options', 'nosniff');\n  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n  response.headers.set('X-DNS-Prefetch-Control', 'off');\n  response.headers.set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains; preload');\n  response.headers.set('Permissions-Policy', 'camera=(), microphone=(), geolocation=()');\n  \n  // Get Supabase URL from environment (validated in lib/env.ts)\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\n  \n  // CSP Header - only add connect-src if supabaseUrl is available\n  const connectSrc = supabaseUrl \n    ? `'self' ${supabaseUrl} https://api.stripe.com`\n    : `'self' https://api.stripe.com`;\n  \n  const cspHeader = `\n    default-src 'self';\n    script-src 'self' 'unsafe-inline' https://js.stripe.com;\n    style-src 'self' 'unsafe-inline';\n    img-src 'self' blob: data: https:;\n    connect-src ${connectSrc};\n    font-src 'self';\n    object-src 'none';\n    base-uri 'self';\n    form-action 'self';\n    frame-ancestors 'none';\n    upgrade-insecure-requests;\n  `.replace(/\\s{2,}/g, ' ').trim();\n  \n  response.headers.set('Content-Security-Policy', cspHeader);\n  \n  return response;\n}\n\nexport const config = {\n  matcher: [\n    '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n  ],\n};"],"names":[],"mappings":";;;;AAAA;AAAA;AAEA;;;AAEO,eAAe,WAAW,OAAoB;IACnD,4DAA4D;IAC5D,MAAM,EAAE,gBAAgB,EAAE,IAAI,EAAE,GAAG,MAAM,CAAA,GAAA,gLAAA,CAAA,gBAAa,AAAD,EAAE;IAEvD,4CAA4C;IAC5C,MAAM,kBAAkB;QAAC;QAAc;QAAa;KAAW;IAC/D,MAAM,mBAAmB,gBAAgB,IAAI,CAAC,CAAA,QAC5C,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAGtC,8CAA8C;IAC9C,MAAM,aAAa;QAAC;QAAe;QAAkB;KAAc;IACnE,MAAM,cAAc,WAAW,IAAI,CAAC,CAAA,QAClC,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAGtC,yBAAyB;IACzB,IAAI,oBAAoB,CAAC,MAAM;QAC7B,+CAA+C;QAC/C,MAAM,WAAW,IAAI,IAAI,eAAe,QAAQ,GAAG;QACnD,SAAS,YAAY,CAAC,GAAG,CAAC,cAAc,QAAQ,OAAO,CAAC,QAAQ;QAChE,OAAO,sYAAA,CAAA,eAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,IAAI,eAAe,MAAM;QACvB,uDAAuD;QACvD,OAAO,sYAAA,CAAA,eAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;IAChE;IAEA,yCAAyC;IACzC,MAAM,WAAW;IAEjB,mBAAmB;IACnB,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,6BAA6B;IAClD,SAAS,OAAO,CAAC,GAAG,CAAC,sBAAsB;IAE3C,8DAA8D;IAC9D,MAAM,cAAc,QAAQ,GAAG,CAAC,wBAAwB;IAExD,gEAAgE;IAChE,MAAM,aAAa,cACf,CAAC,OAAO,EAAE,YAAY,uBAAuB,CAAC,GAC9C,CAAC,6BAA6B,CAAC;IAEnC,MAAM,YAAY,CAAC;;;;;gBAKL,EAAE,WAAW;;;;;;;EAO3B,CAAC,CAAC,OAAO,CAAC,WAAW,KAAK,IAAI;IAE9B,SAAS,OAAO,CAAC,GAAG,CAAC,2BAA2B;IAEhD,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}